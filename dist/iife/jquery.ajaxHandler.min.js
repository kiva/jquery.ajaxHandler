/*
* jquery.ajaxHandler v0.1.1
*
* Copyright (c) 2014 Kiva Microfunds
* Licensed under the MIT license.
* https://github.com/kiva/jquery.ajaxHandler/blob/master/license.txt
*/
!function(a,b){"use strict";a.ajaxHandler={defaults:{isAjaxHandlerEnabled:!1},install:function(b){return a.ajaxHandler.origAjax=a.ajax,a.ajax=a.ajaxHandler.ajaxWrapper,a.ajaxHandler.config(b||{})},remove:function(){a.ajaxHandler.origAjax&&(a.ajax=a.ajaxHandler.origAjax,a.ajaxHandler.origAjax=b),delete a.ajaxHandler.options},config:function(b){return a.ajaxHandler.options=a.extend({},a.ajaxHandler.defaults,b),this.options},ajaxWrapper:function(){var b=Array.prototype.slice.call(arguments),c="string"==typeof b[0]?1:0,d=b[c]||{},e=d.ajaxHandlerOptions;return e=a.extend({},a.ajaxHandler.options,e),e.isAjaxHandlerEnabled?(1==c&&(d.url=b[0]),d.ajaxHandlerOptions=e,a.ajaxHandler.handleAjaxRequest.call(this,d)):a.ajaxHandler.origAjax.apply(this,b)},handleAjaxRequest:function(){var b,c=Array.prototype.slice.call(arguments),d=c[0],e=new a.Deferred,f=d.error;return d.error=null,d.beforeSend&&(d.ajaxHandlerOptions.origBeforeSend=d.beforeSend),b=a.ajaxHandler.ajax.apply(this,c).done(function(a,b,c){e.resolve(a,b,c)}).fail(function(b,c,g){this.error=f,401==b.status&&d.ajaxHandlerOptions.on401?d.ajaxHandlerOptions.on401.call(this,e,b,c,g):a.ajaxHandler.onFail.call(this,e,b,c,g)}),e.promise(b)},ajax:function(b){return b.beforeSend=a.ajaxHandler.onBeforeSend,a.ajaxHandler.origAjax(b)},onFail:function(b,c,d,e){return this.error&&this.error.call(this,c,d,e),"function"==typeof a.ajaxHandler.options.onFail&&a.ajaxHandler.options.onFail.call(this,b,c,d,e),b.reject(c,d,e)},onBeforeSend:function(b,c){var d,e=c.ajaxHandlerOptions;"function"==typeof e.corsUrl&&(d=c.url,c.url=e.corsUrl.call(this,c)),e.requestHeaders&&a.each(e.requestHeaders,function(a,d){b.setRequestHeader(a,"function"==typeof d?d.call(b,c):d)}),d&&(c.url=d),"function"==typeof e.origBeforeSend&&e.origBeforeSend.call(this,b,c)}}}(jQuery);