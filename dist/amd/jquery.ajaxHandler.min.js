/*
* jquery.ajaxHandler v0.1.0
*
* Copyright (c) 2014 Kiva Microfunds
* Licensed under the MIT license.
* https://github.com/kiva/jquery.ajaxHandler/blob/master/license.txt
*/
define(["jquery"],function(a,b){"use strict";return a.ajaxHandler={defaults:{isAjaxHandlerEnabled:!1},install:function(b){return a.ajaxHandler.origAjax=a.ajax,a.ajax=a.ajaxHandler.ajaxWrapper,a.ajaxHandler.config(b||{})},remove:function(){a.ajax=a.ajaxHandler.origAjax,delete a.ajaxHandler.options,a.ajaxHandler.origAjax=b},config:function(b){return a.ajaxHandler.options=a.extend({},a.ajaxHandler.defaults,b),this.options},ajaxWrapper:function(){var b=Array.prototype.slice.call(arguments),c="string"==typeof b[0]?1:0,d=b[c]||{},e=d.ajaxHandlerOptions;return e=a.extend({},a.ajaxHandler.options,e),e.isAjaxHandlerEnabled?(1==c&&(d.url=b[0]),d.ajaxHandlerOptions=e,a.ajaxHandler.handleAjaxRequest.call(this,d)):a.ajaxHandler.origAjax.apply(this,b)},handleAjaxRequest:function(){var b=Array.prototype.slice.call(arguments),c=b[0],d=new a.Deferred,e=c.error;return c.error=null,c.beforeSend&&(c.ajaxHandlerOptions.origBeforeSend=c.beforeSend),a.ajaxHandler.ajax.apply(this,b).done(function(a,b,c){d.resolve(a,b,c)}).fail(function(b,f,g){this.error=e,401==b.status&&c.ajaxHandlerOptions.on401?c.ajaxHandlerOptions.on401.call(this,d,b,f,g):a.ajaxHandler.onFail.call(this,d,b,f,g)}),d.promise()},ajax:function(b){return b.beforeSend=a.ajaxHandler.onBeforeSend,a.ajaxHandler.origAjax(b)},onFail:function(b,c,d,e){return this.error&&this.error.call(this,c,d,e),"function"==typeof a.ajaxHandler.options.onFail&&a.ajaxHandler.options.onFail.call(this,b,c,d,e),b.reject(c,d,e)},onBeforeSend:function(b,c){var d=c.ajaxHandlerOptions;"function"==typeof d.url&&(c.url=d.url.call(this,c)),d.requestHeaders&&a.each(d.requestHeaders,function(a,d){b.setRequestHeader(a,"function"==typeof d?d.call(b,c):d)}),"function"==typeof d.origBeforeSend&&d.origBeforeSend.call(this,b,c)}},a});